<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>All GRAB Cosmetics</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css">
    <style>
        body {
            background-color: #2C2F33;
            color: #fff;
            font-family: Arial, sans-serif;
        }
        .header {
            text-align: center;
            padding: 20px;
        }
        .categories {
            display: flex;
            justify-content: center;
            flex-wrap: wrap;
            margin-bottom: 20px;
        }
        .category {
            background-color: #7289DA;
            border-radius: 8px;
            padding: 10px 20px;
            margin: 5px;
            cursor: pointer;
        }
        .category i {
            margin-right: 5px;
        }
        .content {
            display: flex;
            flex-wrap: wrap;
            justify-content: center;
        }
        .item {
            background-color: #23272A;
            border-radius: 8px;
            margin: 10px;
            padding: 20px;
            text-align: center;
            width: 200px;
        }
        .item img {
            width: 100%;
            height: auto;
            border-radius: 8px;
        }
    </style>
</head>
<body>
    <div class="header">
        <h1>All GRAB Cosmetics</h1>
        <p id="cosmetic-count">Showing 0 Cosmetics</p>
    </div>
    <div class="categories" id="categories">
        <!-- Categories will be injected here by JavaScript -->
    </div>
    <div class="content" id="content">
        <!-- Items will be injected here by JavaScript -->
    </div>

    <script>
        async function fetchCosmetics() {
            try {
                const response = await fetch('https://api.slin.dev/grab/v1/get_shop_catalog?version=2');
                const data = await response.json();
                return data;
            } catch (error) {
                console.error("Error fetching cosmetics data:", error);
                return null;
            }
        }

        async function fetchItemPacks() {
            try {
                const response = await fetch('https://api.slin.dev/grab/v1/get_shop_products?version=2');
                const data = await response.json();
                return data;
            } catch (error) {
                console.error("Error fetching item packs data:", error);
                return null;
            }
        }

        async function fetchShopItems() {
            try {
                const response = await fetch('https://api.slin.dev/grab/v1/get_shop_items?version=2');
                const data = await response.json();
                return data;
            } catch (error) {
                console.error("Error fetching shop items data:", error);
                return null;
            }
        }

        function getCategoryIcon(title) {
            switch (title.toLowerCase()) {
                case 'heads':
                    return '<i class="fas fa-user"></i> ';
                case 'body':
                    return '<i class="fas fa-tshirt"></i> ';
                case 'hats':
                    return '<i class="fas fa-hat-cowboy-side"></i> ';
                case 'glasses':
                    return '<i class="fas fa-glasses"></i> ';
                case 'facewear':
                    return '<i class="fas fa-mask"></i> ';
                case 'hands':
                    return '<i class="fas fa-hand-rock"></i> ';
                case 'grapples':
                    return '<i class="fas fa-hand-sparkles"></i> ';
                case 'checkpoints':
                    return '<i class="fas fa-flag-checkered"></i> ';
                default:
                    return '';
            }
        }

        function renderCategories(data) {
            const categoriesContainer = document.getElementById('categories');

            data.forEach(section => {
                if (section.title === "Open Shop") {
                    const categoryDiv = document.createElement('div');
                    categoryDiv.className = 'category';
                    categoryDiv.innerHTML = `<i class="fas fa-shopping-cart"></i> Item Packs`; 
                    categoryDiv.addEventListener('click', async () => {
                        const itemPacks = await fetchItemPacks();
                        if (itemPacks) {
                            renderItemPacks(itemPacks);
                        }
                    });
                    categoriesContainer.appendChild(categoryDiv);
                } else if (section.title === "Edit Character") {
                    const sections = section.sections.filter(subSection => 
                        subSection.title !== "Change Main Color" && 
                        subSection.title !== "Change Detail Color"
                    );

                    sections.forEach(subSection => {
                        const categoryDiv = document.createElement('div');
                        categoryDiv.className = 'category';
                        categoryDiv.innerHTML = getCategoryIcon(subSection.title) + subSection.title; 
                        categoryDiv.addEventListener('click', async () => {
                            const shopItems = await fetchShopItems();
                            const itemPacks = await fetchItemPacks();
                            renderItems(subSection, shopItems, itemPacks);
                        });
                        categoriesContainer.appendChild(categoryDiv);
                    });
                }
            });
        }

        async function renderItems(section, shopItems, itemPacks) {
            const contentContainer = document.getElementById('content');
            contentContainer.innerHTML = ''; 

            if (!section.items) {
                console.error("Items not found for section:", section.title);
                return;
            }

            renderCosmeticCount(section); 

            section.items.forEach(item => {
                const itemDiv = document.createElement('div');
                itemDiv.className = 'item';

                const title = shopItems[item] ? shopItems[item].title : item;

                let packTitle = 'None';
                for (const pack of Object.values(itemPacks)) {
                    if (pack.items && pack.items.includes(item)) {
                        packTitle = pack.title;
                        break;
                    }
                }

                itemDiv.innerHTML = `<h3>${title}</h3>
                                     <img src="CosmeticsPNG/${item}.png" alt="${title}">
                                     <p>Included in: ${packTitle}</p>`;
                contentContainer.appendChild(itemDiv);
            });
        }

        function renderCosmeticCount(section) {
            const cosmeticCountElement = document.getElementById('cosmetic-count');
            const itemCount = section.items ? section.items.length : 0;
            cosmeticCountElement.textContent = `Showing ${itemCount} Cosmetics`;
        }

        function renderPackCount(packCount) {
            const cosmeticCountElement = document.getElementById('cosmetic-count');
            cosmeticCountElement.textContent = `Showing ${packCount} Packs`;
        }

        async function renderItemPacks(itemPacks) {
            const contentContainer = document.getElementById('content');
            contentContainer.innerHTML = ''; 
            let packCount = 0;
            const currentDate = Math.floor(Date.now() / 1000); 

            Object.values(itemPacks).forEach(pack => {

                if (!['100 Coins', '500 Coins', '1000 Coins', '2100 Coins', '5500 Coins', 'Admin Items', 'Moderator Items'].includes(pack.title)) {

                    const active = pack.active && (!pack.date_end || pack.date_end > currentDate);

                    const price = pack.price_currency ? pack.price_currency : (pack.price_usd ? `${pack.price_usd} USD` : 'Free');

                    const packDiv = document.createElement('div');
                    packDiv.className = 'item';
                    packDiv.innerHTML = `<h3>${pack.title}</h3>
                                         <img src="ItemPacksPNG/${pack.title.toLowerCase().replace(/ /g, '_')}.png" alt="${pack.title}">
                                         <p>${pack.description}</p>
                                         <p>Price: ${price}</p>
                                         <p>Active: ${active ? 'True' : 'False'}</p>`;

                    contentContainer.appendChild(packDiv);
                    packCount++;
                }
            });

            renderPackCount(packCount);
        }

        async function init() {
            const data = await fetchCosmetics();
            if (data) {
                renderCategories(data);
            }
        }

        init();
    </script>
</body>
</html>
